name: steering
description: .kiro/steering/ をプロジェクトメモリとして管理する（ブートストラップ＆同期）
max_movements: 10
initial_movement: detect

# --- カスタムファセット セクションマップ ---
personas:
  steering-analyst: ../personas/steering-analyst.md

policies:
  steering-principles: ../policies/steering-principles.md

instructions:
  detect: ../instructions/detect-steering.md
  bootstrap: ../instructions/bootstrap-steering.md
  sync: ../instructions/sync-steering.md

knowledge:
  steering-templates: ../knowledge/steering-templates.md

report_formats:
  steering-bootstrap: ../output-contracts/steering-bootstrap.md
  steering-sync: ../output-contracts/steering-sync.md

# --- Movement定義 ---
movements:
  # ===== シナリオ検出 =====
  - name: detect
    edit: false
    persona: steering-analyst
    allowed_tools:
      - Read
      - Glob
      - Grep
    instruction: detect
    rules:
      - condition: Bootstrapモード（steeringが存在しない、またはコアファイルが欠けている）
        next: bootstrap
      - condition: Syncモード（全コアファイルが存在する）
        next: sync

  # ===== ブートストラップ =====
  - name: bootstrap
    edit: true
    persona: steering-analyst
    policy: steering-principles
    knowledge: steering-templates
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Write
      - Bash
    required_permission_mode: edit
    instruction: bootstrap
    output_contracts:
      report:
        - name: steering-report.md
          format: steering-bootstrap
    rules:
      - condition: steeringファイル生成完了
        next: COMPLETE
      - condition: テンプレート読み込み失敗等、回復不能なエラーで生成不可
        next: ABORT
        appendix: |
          原因:
          - {問題点}

  # ===== 同期 =====
  - name: sync
    edit: true
    persona: steering-analyst
    policy: steering-principles
    knowledge: steering-templates
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Write
      - Bash
    required_permission_mode: edit
    instruction: sync
    output_contracts:
      report:
        - name: steering-report.md
          format: steering-sync
    rules:
      - condition: 同期完了、更新あり
        next: COMPLETE
      - condition: 同期完了、更新なし（乖離なし）
        next: COMPLETE
      - condition: 分析中にエラー、判断不可
        next: ABORT
        appendix: |
          原因:
          - {問題点}
