- [x] 1. 共通クライアント基盤を構築する
  - 共通契約・境界判定・セッション状態管理を先に固定し、後続実装の判定基準を統一する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 4.3, 4.4, 5.1, 5.4_
- [x] 1.1 ビルドをマルチモジュール構成へ整理し、共通契約と実装モジュールの依存方向を固定する
  - 共通契約を提供する層とプロバイダ実装層を分離し、上位が下位へ依存する構造を作る
  - 契約テスト専用の実行単位を追加し、2実装を同じ観点で検証できる前提を整える
  - _Requirements: 6.1, 6.2_
- [x] 1.2 共通の操作契約と結果契約を定義し、成功と失敗を値として扱う
  - セッション開始・実行・終了の3操作を同一の戻り値契約で統一する
  - 接続不可・セッション終了済み・セッション未登録・入力不正を共通失敗分類として固定する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 5.1, 5.4_
- [x] 1.3 入力境界とセッション状態の共通判定ロジックを実装する
  - 0文字入力のみ失敗、1文字以上は有効として判定を統一する
  - セッション状態を開始済み/終了済みで管理し、未登録と終了済みを区別して返す
  - _Requirements: 2.4, 3.4, 5.1, 5.2, 5.3, 5.4_
- [x] 1.4 成功レスポンスの共通構造を定義する
  - 成功時にプロバイダ識別子、セッション識別子、応答内容を必須で保持する
  - 呼び出し側が実装差分を意識せず処理できる形に統一する
  - _Requirements: 4.3, 4.4_

- [x] 2. (P) Codex 向け実装を共通契約へ適合させる
  - Codex 側の接続・実行・失敗分類を共通契約へ収束させる
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 4.1, 5.2_
- [x] 2.1 (P) 接続設定に基づくセッション開始と終了処理を実装する
  - 接続方式と接続先を使って初期化を完了した場合のみ開始成功とする
  - 接続失敗は共通の接続不可として正規化し、終了処理は状態管理と整合させる
  - _Requirements: 2.1, 2.3_
- [x] 2.2 実行処理の成功・失敗を共通結果へマッピングする
  - 開始済みセッションの実行成功時は、Codex識別を含む成功レスポンスを返す
  - 終了済みセッション実行時は終了済み失敗を返し、入力境界の共通判定を適用する
  - _Requirements: 2.2, 2.4, 4.1, 5.2_

- [x] 3. (P) Claude Code 向け実装を共通契約へ適合させる
  - Claude Code 側の接続・実行・失敗分類を共通契約へ収束させる
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 4.2, 5.3_
- [x] 3.1 (P) 接続設定に基づくセッション開始と終了処理を実装する
  - 接続方式と接続先を使って初期化を完了した場合のみ開始成功とする
  - 接続失敗は共通の接続不可として正規化し、終了処理は状態管理と整合させる
  - _Requirements: 3.1, 3.3_
- [x] 3.2 実行処理の成功・失敗を共通結果へマッピングする
  - 開始済みセッションの実行成功時は、Claude Code識別を含む成功レスポンスを返す
  - 終了済みセッション実行時は終了済み失敗を返し、入力境界の共通判定を適用する
  - _Requirements: 3.2, 3.4, 4.2, 5.3_

- [x] 4. 契約準拠テストを整備して多態性を検証する
  - 共通観点のテスト仕様で2実装の契約準拠と境界条件を継続的に検証可能にする
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 6.1, 6.2_
- [x] 4.1 共通契約テストの再利用可能なテスト仕様を作成する
  - 2実装に共通適用できる成功系・失敗系・境界値の期待値を1セットで定義する
  - 実装固有の差分は注入ポイントで切り替え、検証観点を統一する
  - _Requirements: 6.1, 6.2_
- [x] 4.2 (P) Codex 実装に共通契約テストを適用して全ケース通過を確認する
  - セッション開始、実行、終了の基本フローと失敗分類を網羅する
  - 成功時のプロバイダ識別と共通レスポンス必須項目を検証する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 4.1, 4.3, 4.4, 6.1_
- [x] 4.3 (P) Claude Code 実装に共通契約テストを適用して全ケース通過を確認する
  - セッション開始、実行、終了の基本フローと失敗分類を網羅する
  - 成功時のプロバイダ識別と共通レスポンス必須項目を検証する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 4.2, 4.3, 4.4, 6.2_
- [x] 4.4 共通境界条件の回帰テストを補強する
  - 0文字入力失敗、1文字入力成功、未開始セッション失敗を両実装で同じ期待値に固定する
  - 実装差分があっても失敗分類が逸脱しないことを継続検証できる状態にする
  - _Requirements: 5.1, 5.2, 5.3, 5.4_
